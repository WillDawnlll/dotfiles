# https://github.com/greshake/i3status-rust
icons_format = "{icon}"
#invert_scrolling =true
error_format="???"

[theme]
theme = "dracula"
[theme.overrides]
#separator = "îƒŠ"
separator = "î‚º"
#separator = "î‚²"
#separator_fg = "#ffffff"
idle_bg = "#00333388"
#separator_bg = "#00000088"

[icons]
#icons = "material"
icons = "material-nf"
#icons = "awesome4"
[icons.overrides]
#memory_mem = ""
net_vpn = "î ‹V"
#bat = ["|E|", "|_|", "|=|", "|F|"]
#bat_charging = "|^| "
cpu_boost_on = "î§"
cpu_boost_off = "î¦"

######################
#block

[[block]]
block = "focused_window"
[block.format]
full = "$title.str    |"
short = "$title.str(max_w:10)    |"
[block.theme_overrides]
idle_bg = "#00000000"
#idle_bg = "#00000088"
idle_fg = "#00ffff"


[[block]]
block = "net"
format = "â†“$speed_down â†‘$speed_up"
[block.theme_overrides]
idle_bg = "#00000088"
idle_fg = "#aaaaaa"

[[block]]
block = "net"
interval = 5
format = "{$icon}{$ssid|$device} $ip"
#format = "$icon {$signal_strength $ssid} $ip"
[block.theme_overrides]
idle_fg = "#ffffff"

[[block]]
block = "service_status"
service = "v2raya"
active_format = "^icon_net_vpn"
inactive_format = "^icon_net_vpn"
[block.theme_overrides]
idle_fg = "#00ff00"
idle_bg = "#00333388"
critical_fg = "#777777"
critical_bg = "#00333388"

[[block]]
block = "cpu"
#interval = 10
#format = "$barchart {$boost|}$frequency.eng(w:3,hide_unit:true)~"
format = "{$boost|}$utilization xÌ…{$frequency.eng(w:3,hide_unit:true)}"
format_alt = "{$boost|}$utilization â†‘{$max_frequency.eng(w:3,hide_unit:true)}"
#format = "{$icon}$utilization $frequency.eng(hide_unit:true)"
[block.theme_overrides]
idle_bg = "#00000088"

# cpupower monitor max frequency governor
#[[block]]
#block = "custom"
#command = "printf '[%s %s]' $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq | numfmt --to=si --from-unit K --format '%3.1f') $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_governor)"
#interval = 30
#[block.theme_overrides]
#idle_bg = "#444444"
#idle_fg = "#aaaaaa"

# cpupower switch
# add to /etc/sudoers "username hostname = (root) NOPASSWD: /usr/bin/cpupower"

#### [[block]]
#### block = "custom"
#### #command = "printf '[%s %s]' $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq | numfmt --to=si --from-unit K --format '%3.1f') $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_governor)"
#### format = "$text.pango-str()"
#### cycle = [
####     "sudo cpupower frequency-set -g powersave   -u 1g 1> /dev/null; printf '%s %.2s' $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq | numfmt --to=si --from-unit K --format '%3.0f') $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_governor)",
####     "sudo cpupower frequency-set -g performance -u 5g 1> /dev/null; printf '%s %.2s' $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq | numfmt --to=si --from-unit K --format '%3.0f') $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_governor)"
#### ]
#### interval = "once"
#### [block.theme_overrides]
#### idle_bg = "#444444"
#### idle_fg = "#aaaaaa"
#### [[block.click]]
#### button = "right"
#### action = "cycle"

[[block]]
block = "custom"
format = "$text.pango-str()"
cycle = [
    "sudo cpupower frequency-set -u 5g 1> /dev/null; cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq | numfmt --to=si --from-unit K --format '%3.1f'",
    "sudo cpupower frequency-set -u 400m 1> /dev/null; cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq | numfmt --to=si --from-unit K --format '%3.0f'",
    "sudo cpupower frequency-set -u 1g 1> /dev/null; cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq | numfmt --to=si --from-unit K --format '%3.0f'",
]
    #"sudo cpupower frequency-set -u 2g 1> /dev/null; cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq | numfmt --to=si --from-unit K --format '%3.0f'",
interval = "once"
[block.theme_overrides]
idle_bg = "#00000088"
idle_fg = "#aaaaaa"
[[block.click]]
button = "right"
action = "cycle"

[[block]]
block = "custom"
format = "$text.pango-str()"
cycle = [
    #here printf char icon with color
    "sudo cpupower frequency-set -g powersave 1> /dev/null; printf 'â„ï¸'",
    "sudo cpupower frequency-set -g performance 1> /dev/null; printf 'ðŸ”¥'"
    # TODO : change to turbo boost switch , NOT cpu frequency
]
interval = "once"
[block.theme_overrides]
idle_bg = "#00000088"
idle_fg = "#aaaaaa"
[[block.click]]
button = "right"
action = "cycle"

[[block]]
block = "temperature"
format = "{$icon}$max"
format_alt = "{$icon}~$average"
interval = 10
chip = "*-isa-*"
[block.theme_overrides]
idle_bg = "#44444488"

# sudo need user passwd
#[[block]]
#block = "custom"
#command = ''' sudo intel_gpu_top -l | head -n4 | tail -n1 | awk '{print $8 "%"}' '''
#interval = 5

[[block]]
block = "memory"
format = "{$icon}$mem_used_percents.eng(w:1)"
format_alt = "{$icon_swap}$swap_used.eng(w:3,u:B,p:M)/$swap_total.eng(w:3,u:B,p:M)($swap_used_percents.eng(w:2))"
interval = 30
warning_mem = 70
critical_mem = 90
[block.theme_overrides]
idle_bg = "#44444488"

# battery: /etc/bluetooth/main.conf [General] "Experimental = true" , bluetoothclt info
# https://wiki.archlinux.org/title/bluetooth#Enabling_experimental_features
# https://askubuntu.com/questions/1117563/check-bluetooth-headphones-battery-status-in-linux
# EDIFIER TWS NB3
[[block]]
block = "bluetooth"
mac = "0C:AE:BD:69:19:0D"
#disconnected_format = "{^icon_bluetooth}E"
disconnected_format = ""
format = "^icon_headphones EDI {$battery_icon}{$percentage}"
[block.battery_state]
"0..20" = "critical"
"21..70" = "warning"
"71..100" = "good"
[block.theme_overrides]
idle_bg = "#88888888"
idle_fg = "#ffffffff"

# Mi Air2 SE
[[block]]
block = "bluetooth"
mac = "9C:97:89:59:39:CF"
#disconnected_format = "{^icon_bluetooth}M"
disconnected_format = ""
format = "^icon_headphones MI {$battery_icon}{$percentage}"
[block.battery_state]
"0..20" = "critical"
"21..70" = "warning"
"71..100" = "good"
[block.theme_overrides]
idle_bg = "#88888888"
idle_fg = "#ffffffff"

# k380 keyboard
[[block]]
block = "bluetooth"
mac = "F4:73:35:6F:42:68"
disconnected_format = ""
format = "^icon_bluetooth{^icon_keyboard}K380 {$battery_icon}{$percentage}"
[block.battery_state]
"0..20" = "critical"
"21..70" = "warning"
"71..100" = "good"
[block.theme_overrides]
idle_bg = "#88888888"
idle_fg = "#00000000"

# MX Keys Mini
[[block]]
block = "bluetooth"
#mac = "D9:C2:C9:92:F9:84"
mac = "D9:C2:C9:92:F9:8D"
disconnected_format = ""
format = "^icon_bluetooth{^icon_keyboard}MX"
[block.battery_state]
"0..20" = "critical"
"21..70" = "warning"
"71..100" = "good"
[block.theme_overrides]
idle_bg = "#88888888"
idle_fg = "#00000000"

# XBOX
[[block]]
block = "bluetooth"
mac = "EC:83:50:94:D4:EF"
disconnected_format = ""
format = "{^icon_bluetooth}XBOX"
[block.battery_state]
"0..20" = "critical"
"21..70" = "warning"
"71..100" = "good"
[block.theme_overrides]
idle_bg = "#88888888"
idle_fg = "#00000000"

# Logi POP Mouse
[[block]]
block = "bluetooth"
mac = "DE:E1:9A:F0:54:24"
disconnected_format = ""
format = "$icon{^icon_mouse} POP {$battery_icon}{$percentage}"
[block.battery_state]
"0..20" = "critical"
"21..70" = "warning"
"71..100" = "good"
[block.theme_overrides]
idle_bg = "#88888888"
idle_fg = "#00000000"

[[block]]
block = "sound"
headphones_indicator = true
format = "$icon{$volume|}"
[[block.click]]
button = "left"
cmd = "pavucontrol"
[block.theme_overrides]
idle_bg = "#44444488"

# monitor
#[[block]]
#block = "custom"
#command = "xrandr --listmonitors | tail -n+2 | tr '+' ' ' | cut -d' ' -f 4 | tr '\n' ' '"
#interval = "once"
#signal = 4

#monitor direction
[[block]]
block = "custom"
format = " âœ "
cycle = [
    "xrandr --output $(xrandr -q |grep primary|cut -f1 -d' ') --rotate normal",
    "xrandr --output $(xrandr -q |grep primary|cut -f1 -d' ') --rotate right",
    "xrandr --output $(xrandr -q |grep primary|cut -f1 -d' ') --rotate inverted",
    "xrandr --output $(xrandr -q |grep primary|cut -f1 -d' ') --rotate left"
    #"sudo cpupower frequency-set -g performance -u 5g 1> /dev/null; printf '%s %s' $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_max_freq | numfmt --to=si --from-unit K --format '%3.0f') $(cat /sys/devices/system/cpu/cpufreq/policy0/scaling_governor)"
]
interval = "once"
[block.theme_overrides]
idle_bg = "#00000088"
idle_fg = "#ff8800"
[[block.click]]
button = "right"
action = "cycle"

[[block]]
block = "backlight"
#mipad2 comment
device = "intel_backlight"
format = "$icon{$brightness}"
[block.theme_overrides]
idle_bg = "#00000088"
idle_fg = "#888888"

[[block]]
block = "battery"
#driver = ""
#mipad2 comment no BAT1
device = "BAT1"
interval = 30
format = "$icon $percentage $time $power"
full_format="{$icon}âš¡FULL"
charging_format="{$icon}âš¡ $percentage $time"
not_charging_format ="$icon noâš¡"
missing_format ="$icon missing"

[[block]]
block = "kdeconnect"
format = "{$icon}{$name}{$bat_icon{$bat_charge}|}{$notif_icon |}{$notif_count|}|"
#format = "{$icon}{$name}{$bat_icon{$bat_charge}|}{$notif_icon |}|"
bat_good = 101
[[block.click]]
button = "left"
cmd = "kdeconnect-app"

[[block]]
block = "time"
interval = 60
format = "$timestamp.datetime(f:'%a %m%d %R', l:zh_CN)"
[block.theme_overrides]
idle_bg = "#00000088"
idle_fg = "#00ffff"

#laptop keyboard switch button with fg color change
[[block]]
block = "custom"
format = "âŒ¨"
cycle = [
    #"xinput enable \"AT Translated Set 2 keyboard\";xinput list \"AT Translated Set 2 keyboard\" |grep disabled -q && echo 0 || echo 1âŒ¨",
    #"xinput disable \"AT Translated Set 2 keyboard\";xinput list \"AT Translated Set 2 keyboard\" |grep disabled -q && echo 0 || echo 1âŒ¨",
    '''xinput enable "AT Translated Set 2 keyboard"; printf "{\"state\":\"%s\"}" $(xinput list "AT Translated Set 2 keyboard" |grep disabled -q && echo Idle || echo Critical ) ''',
    '''xinput disable "AT Translated Set 2 keyboard"; printf "{\"state\":\"%s\"}" $(xinput list "AT Translated Set 2 keyboard" |grep disabled -q && echo Idle || echo Critical ) ''',
]
json = true
interval = "once"
[block.theme_overrides]
idle_bg = "#00000088"
idle_fg = "#ff0000"
critical_bg = "#00000088"
critical_fg = "#00ff00"
[[block.click]]
button = "right"
action = "cycle"

#laptop touchpad switch button with fg color change
[[block]]
block = "custom"
format = "ðŸ–°"
cycle = [
    '''xinput enable "MSFT0001:00 04F3:317C Touchpad"; printf "{\"state\":\"%s\"}" $(xinput list "MSFT0001:00 04F3:317C Touchpad" |grep disabled -q && echo Idle || echo Critical ) ''',
    '''xinput disable "MSFT0001:00 04F3:317C Touchpad"; printf "{\"state\":\"%s\"}" $(xinput list "MSFT0001:00 04F3:317C Touchpad" |grep disabled -q && echo Idle || echo Critical ) ''',
]
json = true
interval = "once"
[block.theme_overrides]
idle_bg = "#00000088"
idle_fg = "#ff0000"
critical_bg = "#00000088"
critical_fg = "#00ff00"
[[block.click]]
button = "right"
action = "cycle"

# keyboard CAPS lock status
[[block]]
block = "custom"
format = "CAPS"
command = ''' echo "{\"state\":\"$($(xset -q |rg -o 'Caps Lock:.......'|rg -ioq on) && echo Critical || echo Idle)\"}" '''
json = true
interval = 1
[block.theme_overrides]
idle_bg = "#00000088"
idle_fg = "#aaaaaa"
critical_fg = "#ff00ff"
critical_bg = "#00000088"

[[block]]
block = "music"
#format = "$icon{$combo.str(max_w:4){$play} {$next}|}"
format = "{$icon{$combo.str(max_w:2)}|}"
interface_name_exclude = [".*kdeconnect.*", "mpd"]
[[block.click]]
button = "left"
action = "play_pause"

[[block]]
block = "menu"
text = "âŠž"
[[block.items]]
display = "[X]"
cmd = "i3-msg kill"
[[block.items]]
display = "[F]"
cmd = "i3-msg floating toggle"
[[block.items]]
display = "[^]"
cmd = "i3-msg fullscreen toggle"
[[block.items]]
display = "[>]"
cmd = "i3-msg move container to workspace next;i3-msg workspace next"
[block.theme_overrides]
idle_bg = "#000000"
idle_fg = "#00ffff"

#TODO dmenu
#[[block]]
#block = "custom"
#text = "âŠž"
#command = ''' echo "{\"state\":\"$($(xset -q |rg -o 'Caps Lock:.......'|rg -ioq on) && echo Critical || echo Idle)\"}" '''
#json = true
#interval = 1
#[block.theme_overrides]
#idle_bg = "#00000088"
#idle_fg = "#aaaaaa"
#critical_fg = "#ff00ff"
#critical_bg = "#00000088"
